---
title: "Rocky Linux 9 - CVE-2024-6387: regreSSHion"
date: "2024-07-01"
author: "Neil Hanlon"
---

## CVE-2024-6387: OpenSSH Vulnerability in Rocky Linux 9

A critical vulnerability, identified as [CVE-2024-6387](https://nvd.nist.gov/vuln/detail/CVE-2024-6387), affects OpenSSH server (sshd) on all Enterprise Linux 9 systems (including Rocky Linux 9). This issue involves a signal handler race condition that can lead to a potential remote code execution or, more likely, a denial of service (DoS) attack.

### Details

A client failing to authenticate within the LoginGraceTime (120 seconds by default) triggers sshd's SIGALRM handler, which calls non async-signal-safe functions like syslog(). This vulnerability does not affect versions shipped with Enterprise Linux 8, as the problematic code was introduced in later upstream releases.

### Risk Potential

While remote code execution is possible, it requires a complex and time-consuming race condition. Most attacks would more likely result in the sshd service crashing, leading to availability issues. High volumes of connections might be detectable via network monitoring.

### Mitigation

To address this issue, you can either update to `openssh-8.7p1-38.el9_4.security.0.5` from the SIG/Security repository or configure your ssh server to reduce the `LoginGraceTime` parameter.

#### SIG/Security

1. Install the SIG/Security release file
```
dnf install rocky-release-security
```
2. Upgrade openssh
```
dnf --enablerepo=security-common update openssh\*
```
3. Confirm version `openssh-8.7p1-38.el9_4.security.0.5` is installed
```
rpm -q openssh
```

During the installation of openssh, the service will be automatically restarted.

##### Note

The release package can be installed on other Enterprise Linux distributions. See [sig-security wiki](https://sig-security.rocky.page/) for more information.

#### `LoginGraceTime` mitigation

1. As root, open `/etc/ssh/sshd_config`.
2. Add or modify the `LoginGraceTime` parameter:
   ```
   LoginGraceTime 0
   ```
3. Save and close the file.
4. Restart the sshd service:
   ```
   systemctl restart sshd.service
   ```

##### Note

Setting `LoginGraceTime` to `0` mitigates remote code execution risks but remains susceptible to DoS attacks. It is recommended to also configure `MaxStartups` to an appropriate value if applying the `LoginGraceTime` mitigation.
